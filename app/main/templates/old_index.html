<!DOCTYPE html>
<html>
<head>
    <title>Create Route</title>
    <!-- Add Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <h1>Create Route</h1>
    <label for="latitude1">Latitude 1:</label>
    <input type="text" id="latitude1" name="latitude1" required>
    <label for="longitude1">Longitude 1:</label>
    <input type="text" id="longitude1" name="longitude1" required>

    <label for="latitude2">Latitude 2:</label>
    <input type="text" id="latitude2" name="latitude2" required>
    <label for="longitude2">Longitude 2:</label>
    <input type="text" id="longitude2" name="longitude2" required>

    <button id="toggleButton" onclick="toggleInputs()">Toggle Point</button>

    <!-- Add the map container -->
    <div id="map" style="height: 400px;"></div>

    <button id="createRouteBtn" onclick="createRoute()">Create Route</button>
    <div id="routeResult"></div>
    <!-- Add Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
        var map;
        var marker1, marker2;
        var currentPoint = 1;

        // Function to initialize the map
        function initMap() {
            // Create a map object with the specified center and zoom level
            map = L.map('map').setView([31.891035, 34.894937], 8);

            // Add a tile layer to the map
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

            // Add a click event listener to the map
            map.on('click', function (e) {
                // Get the latitude and longitude of the clicked point
                var lat = e.latlng.lat.toFixed(6);
                var lng = e.latlng.lng.toFixed(6);

                // Update the input fields and markers based on the currentPoint
                if (currentPoint === 1) {
                    document.getElementById('latitude1').value = lat;
                    document.getElementById('longitude1').value = lng;
                    if (marker1) {
                        marker1.setLatLng([lat, lng]);
                    } else {
                        marker1 = L.marker([lat, lng]).addTo(map);
                    }
                } else if (currentPoint === 2) {
                    document.getElementById('latitude2').value = lat;
                    document.getElementById('longitude2').value = lng;
                    if (marker2) {
                        marker2.setLatLng([lat, lng]);
                    } else {
                        marker2 = L.marker([lat, lng]).addTo(map);
                    }
                }
            });
        }

        // Call the function to initialize the map
        initMap();

        // Function to toggle between the two input points
        function toggleInputs() {
            if (currentPoint === 1) {
                currentPoint = 2;
                document.getElementById('toggleButton').innerText = 'Toggle Point (2)';
            } else {
                currentPoint = 1;
                document.getElementById('toggleButton').innerText = 'Toggle Point (1)';
            }
        }

        // Function to send the GET request to the server
        function createRoute() {
            var lat1 = document.getElementById('latitude1').value;
            var lng1 = document.getElementById('longitude1').value;
            var lat2 = document.getElementById('latitude2').value;
            var lng2 = document.getElementById('longitude2').value;

            // Create the route URL with the input values
            var routeURL = `/get_route?lat1=${lat1}&lng1=${lng1}&lat2=${lat2}&lng2=${lng2}`;

            // Send the GET request to the server
            // Replace this with your actual request handling logic (e.g., using fetch or AJAX)
            // alert('Sending GET request to: ' + routeURL);
            // window.location.href = routeURL;
              const LeafIcon = L.Icon.extend({
                options: {}
              });
            greenIcon = new LeafIcon({
                  iconUrl:
                    "https://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|2ecc71&chf=a,s,ee00FFFF"
                });
            // Send GET request to the server
            fetch(routeURL)
                .then(response => response.text())
                    .then(data => {
                        // document.getElementById('routeResult').textContent = data;
                        document.getElementById('routeResult').textContent = JSON.stringify(data);

                        // Add all points to the allPointsMap
                      pointsData = JSON.parse(data);
                      var allPointsFeatures = pointsData.map(point => {
                        L.marker([point.latitude, point.longitude], {icon: greenIcon}).addTo(map)
                      });


            });
        }
    </script>
</body>
</html>
